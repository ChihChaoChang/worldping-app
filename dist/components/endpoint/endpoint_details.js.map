{"version":3,"sources":["../../../src/components/endpoint/endpoint_details.js"],"names":[],"mappings":"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","file":"endpoint_details.js","sourcesContent":["import _ from 'lodash';\n\nclass EndpointDetailsCtrl {\n\n  /** @ngInject */\n  constructor($scope, $injector, $location, backendSrv, contextSrv) {\n    var self = this;\n    this.isOrgEditor = contextSrv.hasRole(\"Admin\") || contextSrv.hasRole(\"Editor\");\n    this.backendSrv = backendSrv;\n    this.$location = $location;\n    this.pageReady = false;\n\n    this.endpoints = [];\n    this.monitors = {};\n    this.monitor_types = {};\n    this.monitor_types_by_name = {};\n    this.endpoint = null;\n    this.refreshTime = new Date();\n    this.getMonitorTypes();\n    var promise = this.getEndpoints();\n    promise.then(function() {\n      self.getEndpoint($location.search().endpoint);\n    });\n\n    this.checktypes = [\n      {name: 'DNS', dashName: 'worldping-endpoint-dns?'},\n      {name: 'Ping', dashName: 'worldping-endpoint-ping?'},\n      {name: 'HTTP', dashName: 'worldping-endpoint-web?var-protocol=http&'},\n      {name: 'HTTPS', dashName: 'worldping-endpoint-web?var-protocol=https&'}\n    ];\n  }\n\n  getEndpoints() {\n    var self = this;\n    var promise = this.backendSrv.get('api/plugin-proxy/raintank-worldping-app/api/endpoints');\n    promise.then(function(endpoints) {\n      self.endpoints = endpoints;\n    });\n    return promise;\n  }\n\n  tagsUpdated() {\n    this.backendSrv.post(\"api/plugin-proxy/raintank-worldping-app/api/endpoints\", this.endpoint);\n  }\n\n  getMonitorTypes() {\n    var self = this;\n    this.backendSrv.get('api/plugin-proxy/raintank-worldping-app/api/monitor_types').then(function(types) {\n      _.forEach(types, function(type) {\n        self.monitor_types[type.id] = type;\n        self.monitor_types_by_name[type.name] = type;\n      });\n    });\n  }\n\n  getEndpoint(id) {\n    var self = this;\n    _.forEach(this.endpoints, function(endpoint) {\n      if (endpoint.id === parseInt(id)) {\n        self.endpoint = endpoint;\n        //get monitors for this endpoint.\n        self.backendSrv.get('api/plugin-proxy/raintank-worldping-app/api/monitors?endpoint_id='+id).then(function(monitors) {\n          _.forEach(monitors, function(monitor) {\n            self.monitors[monitor.monitor_type_id] = monitor;\n          });\n          self.pageReady = true;\n        });\n      }\n    });\n  }\n\n  getMonitorByTypeName(name) {\n    if (name in this.monitor_types_by_name) {\n      var type = this.monitor_types_by_name[name];\n      return this.monitors[type.id];\n    }\n    return undefined;\n  }\n\n  //TODO: move to directive.\n  monitorStateTxt(type) {\n    var mon = this.getMonitorByTypeName(type);\n    if (typeof(mon) !== \"object\") {\n      return \"disabled\";\n    }\n    if (!mon.enabled) {\n      return \"disabled\";\n    }\n    if (mon.state < 0 || mon.state > 2) {\n      var sinceUpdate = new Date().getTime() - new Date(mon.updated).getTime();\n      if (sinceUpdate < (mon.frequency * 5 * 1000)) {\n        return 'pending';\n      }\n      return 'nodata';\n    }\n    var states = [\"online\", \"warn\", \"critical\"];\n    return states[mon.state];\n  }\n\n  //TODO: move to directive.\n  monitorStateClass(type) {\n    var mon = this.getMonitorByTypeName(type);\n    if (typeof(mon) !== \"object\") {\n      return \"disabled\";\n    }\n    if (!mon.enabled) {\n      return \"disabled\";\n    }\n    if (mon.state < 0 || mon.state > 2) {\n      return 'nodata';\n    }\n    var states = [\"online\", \"warn\", \"critical\"];\n    return states[mon.state];\n  }\n\n  //TODO: move to directive.\n  stateChangeStr(type) {\n    var mon = this.getMonitorByTypeName(type);\n    if (typeof(mon) !== \"object\") {\n      return \"\";\n    }\n    var duration = new Date().getTime() - new Date(mon.state_change).getTime();\n    if (duration < 10000) {\n      return \"a few seconds ago\";\n    }\n    if (duration < 60000) {\n      var secs = Math.floor(duration/1000);\n      return \"for \" + secs + \" seconds\";\n    }\n    if (duration < 3600000) {\n      var mins = Math.floor(duration/1000/60);\n      return \"for \" + mins + \" minutes\";\n    }\n    if (duration < 86400000) {\n      var hours = Math.floor(duration/1000/60/60);\n      return \"for \" + hours + \" hours\";\n    }\n    var days = Math.floor(duration/1000/60/60/24);\n    return \"for \" + days + \" days\";\n  }\n\n  setEndpoint(id) {\n    this.$location.url('plugins/raintank-worldping-app/page/endpoint_details?endpoint='+id);\n  }\n\n  gotoDashboard(endpoint, type) {\n    if (!type) {\n      type = 'summary';\n    }\n    var search = {\n      \"var-probe\": \"All\",\n      \"var-endpoint\": this.endpoint.slug\n    };\n    switch(type.toLowerCase()) {\n      case \"summary\":\n        this.$location.path(\"/dashboard/db/worldping-endpoint-summary\").search(search);\n        break;\n      case \"ping\":\n        this.$location.path(\"/dashboard/db/worldping-endpoint-ping\").search(search);\n        break;\n      case \"dns\":\n        this.$location.path(\"/dashboard/db/worldping-endpoint-dns\").search(search);\n        break;\n      case \"http\":\n        search['var-protocol'] = \"http\";\n        this.$location.path(\"/dashboard/db/worldping-endpoint-web\").search(search);\n        break;\n      case \"https\":\n        search['var-protocol'] = \"https\";\n        this.$location.path(\"/dashboard/db/worldping-endpoint-web\").search(search);\n        break;\n      default:\n        this.$location.path(\"/dashboard/db/worldping-endpoint-summary\").search(search);\n        break;\n    }\n  }\n\n  gotoEventDashboard(endpoint, type) {\n    this.$location.url(\"/dashboard/db/worldping-events\").search({\n      \"var-probe\": \"All\",\n      \"var-endpoint\": endpoint.slug,\n      \"var-monitor_type\": type.toLowerCase()\n    });\n  }\n\n  getNotificationEmails(checkType) {\n    var mon = this.getMonitorByTypeName(checkType);\n    if (!mon || mon.health_settings.notifications.addresses === \"\") {\n      return [];\n    }\n    var addresses = mon.health_settings.notifications.addresses.split(',');\n    var list = [];\n    addresses.forEach(function(addr) {\n      list.push(addr.trim());\n    });\n    return list;\n  }\n\n  getNotificationEmailsAsString(checkType) {\n    var emails = this.getNotificationEmails(checkType);\n    if (emails.length < 1) {\n      return \"No recipients specified\";\n    }\n    var list = [];\n    emails.forEach(function(email) {\n      // if the email in the format `display name <email@address>`\n      // then just show the display name.\n      var res = email.match(/\\\"?(.+)\\\"?\\s*<.*@.*>/);\n      if (res && res.length === 2) {\n        list.push(res[1]);\n      } else {\n        list.push(email);\n      }\n    });\n    return list.join(\", \");\n  }\n\n  refresh() {\n    this.pageReady = false;\n    this.getEndpoint(this.endpoint.id);\n    this.refreshTime = new Date();\n  }\n}\n\nEndpointDetailsCtrl.templateUrl = 'public/plugins/raintank-worldping-app/components/endpoint/partials/endpoint_details.html';\nexport {EndpointDetailsCtrl};\n"]}