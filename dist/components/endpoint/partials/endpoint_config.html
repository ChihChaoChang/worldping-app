<div ng-if="ctrl.pageReady && !ctrl.endpoint.id" class="page-header">
  <h1>Add a new endpoint</h1>
</div>
<p ng-if="ctrl.pageReady && !ctrl.endpoint.id" class="playlist-description">An endpoint is anything you want to monitor. <br><br>When you enter the fully qualified domain name of your endpoint, worldPing will automatically detect what is available to monitor (eg. PING, HTTP, HTTPS) and suggest a customizable set of defaults unique to your endpoint.</p>

<div ng-if="ctrl.endpoint.id" class="page-header">
  <h1>{{ctrl.endpoint.name}}<a ng-click="ctrl.gotoDashboard(ctrl.endpoint)"><i ng-class="icon" class="icon-gf icon-gf-dashboard" bs-tooltip="'Go to Litmus: Summary </br>dashboard for this endpoint'"></i></a></h1>
    <div class="gf-form wp-tag-margin--bottom">
      <span class="gf-form-label width-6">Tags:</span>
    <bootstrap-tagsinput ng-model="ctrl.endpoint.tags" tagclass="label rt-label-tag" placeholder="New Tag" on-tags-updated="ctrl.tagsUpdated()" ></bootstrap-tagsinput>
  </div>

  <div class="page-header-tabs">
    <ul class="gf-tabs">
      <li class="gf-tabs-item">
        <a class="gf-tabs-link" href="plugins/worldping-app/page/endpoint-details?endpoint={{ctrl.endpoint.id}}">
          Status
        </a>
      </li>
      <li class="gf-tabs-item">
        <a class="gf-tabs-link active" href="plugins/worldping-app/page/endpoint-config?endpoint={{ctrl.endpoint.id}}">
          Configuration
        </a>
      </li>
    </ul>
  </div>
</div>


<form name="endpointForm">
  <div class="gf-form-group" ng-if="ctrl.endpoint.id">
    <div class="gf-form">
      <span class="gf-form-label width-7">Endpoint</span>
      <input class="gf-form-input max-width-21" type="text" ng-model="ctrl.newEndpointName" placeholder="www.example.com" required>
      <info-popover offset="0px -105px">
        Enter a domain name, URL or IP address.
      </info-popover>
    </div>
    <br>
    <div class="gf-form-buttons-row">
      <button class="btn btn-success" ng-click="ctrl.updateEndpoint(ctrl.endpoint)">Update Endpoint Name</button>
    </div>
  </div>

<!--   <div class="gf-form-group" ng-if="!ctrl.endpoint.id  && ctrl.pageReady">
    <div class="gf-form">
      <span class="gf-form-label width-9">Endpoint Name</span>
      <input class="gf-form-input max-width-21" type="text" ng-model="ctrl.newEndpointName" placeholder="www.example.com" required>
      <info-popover offset="0px -95px">
        Enter a domain name, URL or IP address.
      </info-popover>
    </div>
    <br>
    <div class="gf-form-buttons-row">
      <button class="btn btn-success" ng-click="ctrl.updateEndpoint(ctrl.endpoint)">Update Endpoint Name</button>
    </div>
  </div> -->

     <div class="rt-mini-form new-endpoint-domain-form" ng-if="!ctrl.endpoint.id  && ctrl.pageReady">
        <div class="rt-mini-form-col">
            <label ng-hide="ctrl.discovered || ctrl.discoveryError || ctrl.showConfig" class="rt-form-label-medium">Enter a domain name, URL or IP address:</label>
            <label ng-show="ctrl.showConfig || ctrl.discoveryError" class="rt-form-label-medium">Endpoint Name</label>
            <input type="text" class="rt-form-input" ng-model="ctrl.endpoint.name" required="" ng-hide="ctrl.discovered" ng-class="{ 'rt-text-box-success' : ctrl.discovered, 'rt-font-shrinker' : ctrl.endpoint.name > 10 }">
            <div ng-show="ctrl.discovered"><input class="gf-form-input max-width-21" type="text" ng-model="ctrl.endpoint.name" placeholder="www.example.com" required></div>
        </div>
        <div class="rt-mini-form-col">
        <div ng-hide="ctrl.showConfig || ctrl.discoveryInProgress || ctrl.discoveryError">
                <button type="submit" class="secondaryCTA ButtonTall" ng-click="endpointForm.$valid && ctrl.discover(ctrl.endpoint)">Auto Discover</button>
            </div>
            <div ng-show="ctrl.discoveryInProgress">
                <svg width="25" height="25" viewBox="0 0 44 44" xmlns="http://www.w3.org/2000/svg" stroke="#13B3D4" class="puff">
                    <g fill="none" fill-rule="evenodd" stroke-width="3">
                        <circle cx="22" cy="22" r="1">
                            <animate attributeName="r"
                                begin="0s" dur="3s"
                                values="1; 20"
                                calcMode="spline"
                                keyTimes="0; 1"
                                keySplines="0.165, 0.84, 0.44, 1"
                                repeatCount="indefinite" />
                            <animate attributeName="stroke-opacity"
                                begin="0s" dur="3s"
                                values="1; 0"
                                calcMode="spline"
                                keyTimes="0; 1"
                                keySplines="0.3, 0.61, 0.355, 1"
                                repeatCount="indefinite" />
                        </circle>
                        <circle cx="22" cy="22" r="1">
                            <animate attributeName="r"
                                begin="-1.5s" dur="3s"
                                values="1; 20"
                                calcMode="spline"
                                keyTimes="0; 1"
                                keySplines="0.165, 0.84, 0.44, 1"
                                repeatCount="indefinite" />
                            <animate attributeName="stroke-opacity"
                                begin="-1.5s" dur="3s"
                                values="1; 0"
                                calcMode="spline"
                                keyTimes="0; 1"
                                keySplines="0.3, 0.61, 0.355, 1"
                                repeatCount="indefinite" />
                        </circle>
                    </g>
                </svg>
                <span class="rt-body-copy">Discovery in progress...</span>
                <a ng-click="ctrl.skipDiscovery()">skip</a>
            </div>
            <!-- Below replaces Auto-Discover button on success -->
            <div ng-show="ctrl.discovered">
                <p class="rt-body-copy">
                    <b>Discovery Successful.</b> We've suggested some default checks below based on what we were able to detect. <a class="rt-modal-body-link" ng-click="ctrl.reset()">Start Over</a>
                </p>
            </div>
            <div ng-show="ctrl.discoveryError">
                 <p class="rt-body-copy">
                     <b>Failed to discover endpoint.</b> From here, you can <a ng-click="ctrl.skipDiscovery()" class="rt-modal-body-link">configure manually</a> or <a class="rt-modal-body-link" ng-click="ctrl.reset()">start over</a>.
                 </p>
            </div>
            <div ng-show="!ctrl.discovered && ctrl.showConfig">
                <p class="rt-body-copy">
                    <b>Discovery Skipped. </b>You can manually configure your endpoint below or <a class="rt-modal-body-link" ng-click="ctrl.reset()">start over</a> to enter a new domain.
                </p>
            </div>
        </div>
    </div>
  </div>
  <div ng-if="ctrl.showConfig || ctrl.endpoint.id" >
    <div ng-repeat="check in ctrl.endpoint.checks|orderBy:ctrl.orderChecks">
      <div ng-include src="'public/plugins/worldping-app/components/endpoint/partials/'+check.type+'Form.html'"></div>
    </div>
  </div>
</form>
<div ng-show="ctrl.endpoint.id" ng-include src="'public/plugins/worldping-app/components/endpoint/partials/destroyForm.html'"></div>
<div ng-show="ctrl.showConfig" class="editor-row">
    <div class="editor-option">
        <bootstrap-tagsinput ng-model="ctrl.endpoint.tags" tagclass="label label-tag" placeholder="add tags"></bootstrap-tagsinput>
    </div>
</div>
<div ng-show="ctrl.showConfig">
    <button type="submit" class="rt-btn btn-modal" ng-click="endpointForm.$valid && ctrl.addEndpoint(ctrl.endpoint)">Add</button>
    <span class="cancel-primary" ng-click="ctrl.cancel();">Cancel</span>
</div>
</div>
</div>
